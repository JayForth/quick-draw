(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))e(c);new MutationObserver(c=>{for(const l of c)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function r(c){const l={};return c.integrity&&(l.integrity=c.integrity),c.referrerPolicy&&(l.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?l.credentials="include":c.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function e(c){if(c.ep)return;c.ep=!0;const l=r(c);fetch(c.href,l)}})();const y=document.getElementById("game"),t=y.getContext("2d"),C=document.getElementById("hidden-input"),ht=2.5;function it(){const o=window.innerWidth;let a=o/ht;const r=window.innerHeight;a>r&&(a=r),y.width=o,y.height=a}it();window.addEventListener("resize",it);const L=[{top:"#5BA3D9",mid:"#87CEEB",bottom:"#E8DCC4",sun:"#FFFDE7",sunGlow:"#FFF8E1",sunY:.15,isNight:!1},{top:"#6B9BC3",mid:"#9DC4D9",bottom:"#E8D4B8",sun:"#FFF8E1",sunGlow:"#FFECB3",sunY:.22,isNight:!1},{top:"#7A9DBF",mid:"#C4A77D",bottom:"#E8C4A0",sun:"#FFE082",sunGlow:"#FFCC80",sunY:.3,isNight:!1},{top:"#8B6B61",mid:"#D4956B",bottom:"#E8A870",sun:"#FFB74D",sunGlow:"#FFA726",sunY:.4,isNight:!1},{top:"#4A2C4A",mid:"#C75B5B",bottom:"#F4A259",sun:"#FF8A65",sunGlow:"#FF7043",sunY:.52,isNight:!1},{top:"#1A1A2E",mid:"#2D2D44",bottom:"#4A3A5E",sun:"#E8E8E8",sunGlow:"#B0B0B0",sunY:.12,isNight:!0},{top:"#151525",mid:"#252538",bottom:"#3A3A52",sun:"#E0E0E0",sunGlow:"#A0A0A0",sunY:.2,isNight:!0},{top:"#101020",mid:"#1E1E30",bottom:"#2E2E45",sun:"#D8D8D8",sunGlow:"#909090",sunY:.28,isNight:!0},{top:"#0D0D1A",mid:"#1A1A2E",bottom:"#2A2A40",sun:"#D0D0D0",sunGlow:"#888888",sunY:.36,isNight:!0},{top:"#151525",mid:"#2A2A40",bottom:"#3D3D55",sun:"#C8C8C8",sunGlow:"#808080",sunY:.45,isNight:!0}],h={skin:"#E8B89D",hat:"#8B4513",hatBand:"#DAA520",shirt:"#B22222",vest:"#4A3728",pants:"#3D5C5C",boots:"#2F1F14",gun:"#4A4A4A",gunHighlight:"#6A6A6A"},x={textPrimary:"#FFFFFF",textCorrect:"#00E676",textError:"#FF1744",textStreak:"#FFD700"},i={phase:"idle",currentWord:"",playerTyped:"",playerProgress:0,playerArmDisplay:0,playerErrors:0,aiProgress:0,aiArmDisplay:0,aiTyped:"",winStreak:0,countdownValue:3,winner:null,playerFinishTime:null,aiFinishTime:null,roundStartTime:null,showDraw:!1,showingResult:!1,errorShakeUntil:0,muzzleFlashUntil:0,currentBg:0,wrongChar:null,countdownInterval:null,roundEndTime:null,timeouts:[],bullet:null,blood:[]},v={player:{position:0,velocity:0,target:0},ai:{position:0,velocity:0,target:0},stiffness:.3,damping:.6,maxVelocity:.15};function dt(){const o=v.player,a=(o.target-o.position)*v.stiffness;o.velocity+=a,o.velocity*=v.damping,o.velocity=Math.max(-.15,Math.min(v.maxVelocity,o.velocity)),o.position+=o.velocity,i.playerArmDisplay=o.position;const r=v.ai,e=(r.target-r.position)*v.stiffness;r.velocity+=e,r.velocity*=v.damping,r.velocity=Math.max(-.15,Math.min(v.maxVelocity,r.velocity)),r.position+=r.velocity,i.aiArmDisplay=r.position}function Q(o){v.player.target=o}function _(o){v.ai.target=o}const p={active:!1,isPlayer:!1,startTime:0,parts:{head:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0},torso:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0},armGun:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0},armBack:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0},legL:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0},legR:{x:0,y:0,vx:0,vy:0,rot:0,vrot:0}},gravity:.8,groundY:0,friction:.85};function ut(){if(!p.active)return;s(1);const o=0;for(const a in p.parts){const r=p.parts[a];r.vy+=p.gravity,r.x+=r.vx,r.y+=r.vy,r.rot+=r.vrot,r.y>o&&(r.y=o,r.vy*=-.3,r.vx*=p.friction,r.vrot*=.7,Math.abs(r.vy)<1&&(r.vy=0)),r.vx*=.99,r.vrot*=.98}}function ft(){p.active=!1;for(const o in p.parts){const a=p.parts[o];a.x=0,a.y=0,a.vx=0,a.vy=0,a.rot=0,a.vrot=0}}function Z(o,a,r,e,c){const n=r-o,f=e-a,d=Math.sqrt(n*n+f*f);i.bullet={x:o,y:a,vx:n/d*35,vy:f/d*35,targetX:r,targetY:e,isPlayerShooting:c}}function yt(){if(!i.bullet)return;const o=i.bullet;o.x+=o.vx,o.y+=o.vy;const a=o.targetX-o.x,r=o.targetY-o.y;if(Math.sqrt(a*a+r*r)<30){pt(o.x,o.y,o.vx,o.vy);const c=!o.isPlayerShooting,l=c?y.width*.25:y.width*.75,n=y.height*.8;Tt(c,l,n,o.vx,o.vy),i.bullet=null}}function pt(o,a,r,e){const c=25+Math.floor(Math.random()*15);for(let l=0;l<c;l++){const n=(Math.random()-.5)*2,f=3+Math.random()*8,d=Math.atan2(e,r)+n;i.blood.push({x:o+(Math.random()-.5)*20,y:a+(Math.random()-.5)*20,vx:Math.cos(d)*f+(Math.random()-.5)*3,vy:Math.sin(d)*f+(Math.random()-.5)*3-2,size:3+Math.random()*6,life:1})}}function gt(){const a=y.height*.8;for(let r=i.blood.length-1;r>=0;r--){const e=i.blood[r];e.vy+=.4,e.x+=e.vx,e.y+=e.vy,e.life-=.008,e.y>a&&(e.y=a,e.vy*=-.3,e.vx*=.8,e.life-=.05),e.life<=0&&i.blood.splice(r,1)}}function mt(){if(!i.bullet)return;const o=i.bullet;t.fillStyle="#444",t.beginPath(),t.arc(o.x,o.y,s(4),0,Math.PI*2),t.fill(),t.strokeStyle="rgba(100, 100, 100, 0.5)",t.lineWidth=s(2),t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(o.x-o.vx*2,o.y-o.vy*2),t.stroke()}function vt(){for(const o of i.blood)t.globalAlpha=o.life,t.fillStyle="#8B0000",t.beginPath(),t.arc(o.x,o.y,o.size,0,Math.PI*2),t.fill();t.globalAlpha=1}function Tt(o,a,r,e,c){p.active=!0,p.isPlayer=o,p.startTime=Date.now(),p.groundY=r;const l=12,n=e>0?l:-l,f=-8;p.parts.head={x:0,y:-s(80),vx:n*1.2+(Math.random()-.5)*4,vy:f-4+Math.random()*2,rot:0,vrot:(e>0?1:-1)*(.2+Math.random()*.2)},p.parts.torso={x:0,y:-s(50),vx:n+(Math.random()-.5)*2,vy:f+Math.random()*2,rot:0,vrot:(e>0?1:-1)*(.1+Math.random()*.1)},p.parts.armGun={x:0,y:-s(60),vx:n*1.3+(Math.random()-.5)*3,vy:f-2+Math.random()*3,rot:0,vrot:(e>0?1:-1)*(.25+Math.random()*.2)},p.parts.armBack={x:0,y:-s(60),vx:n*.8+(Math.random()-.5)*3,vy:f+1+Math.random()*2,rot:0,vrot:(e>0?1:-1)*(.15+Math.random()*.15)},p.parts.legL={x:-s(10),y:-s(20),vx:n*.6+(Math.random()-.5)*2,vy:f+3+Math.random()*2,rot:0,vrot:(e>0?1:-1)*(.1+Math.random()*.1)},p.parts.legR={x:s(10),y:-s(20),vx:n*.7+(Math.random()-.5)*2,vy:f+2+Math.random()*2,rot:0,vrot:(e>0?1:-1)*(.12+Math.random()*.1)}}function tt(o,a,r){t.save();const e=s(1),c=s(3);t.lineWidth=c,t.lineCap="round",t.lineJoin="round",t.strokeStyle="#000";const l=p.parts;function n(f,d){t.save(),t.translate(o+f.x,a+f.y),t.rotate(f.rot),d(),t.restore()}n(l.legL,()=>{t.fillStyle=h.pants,t.beginPath(),t.roundRect(-e*6,-e*45,e*12,e*30,e*3),t.fill(),t.stroke(),t.fillStyle=h.boots,t.beginPath(),t.roundRect(-e*8,-e*15,e*16,e*15,e*2),t.fill(),t.stroke()}),n(l.legR,()=>{t.fillStyle=h.pants,t.beginPath(),t.roundRect(-e*6,-e*45,e*12,e*30,e*3),t.fill(),t.stroke(),t.fillStyle=h.boots,t.beginPath(),t.roundRect(-e*8,-e*15,e*16,e*15,e*2),t.fill(),t.stroke()}),n(l.armBack,()=>{t.fillStyle=h.shirt,t.beginPath(),t.roundRect(-e*5,-e*30,e*10,e*25,e*3),t.fill(),t.stroke(),t.fillStyle=h.skin,t.beginPath(),t.arc(0,0,e*6,0,Math.PI*2),t.fill(),t.stroke()}),n(l.torso,()=>{t.fillStyle=h.shirt,t.beginPath(),t.moveTo(-e*15,-e*50),t.lineTo(e*15,-e*50),t.lineTo(e*12,0),t.lineTo(-e*12,0),t.closePath(),t.fill(),t.stroke(),t.fillStyle=h.vest,t.beginPath(),t.moveTo(e*5,-e*50),t.lineTo(e*14,-e*45),t.lineTo(e*10,0),t.lineTo(e*5,0),t.closePath(),t.fill(),t.stroke()}),n(l.armGun,()=>{t.fillStyle=h.shirt,t.beginPath(),t.roundRect(-e*5,-e*30,e*10,e*25,e*3),t.fill(),t.stroke(),t.fillStyle=h.skin,t.beginPath(),t.arc(0,0,e*6,0,Math.PI*2),t.fill(),t.stroke(),t.fillStyle=h.gun,t.beginPath(),t.roundRect(-e*3,-e*5,e*20,e*6,e*1),t.fill(),t.stroke()}),n(l.head,()=>{t.fillStyle=h.skin,t.fillRect(-e*5,e*5,e*10,e*10),t.strokeRect(-e*5,e*5,e*10,e*10),t.fillStyle=h.skin,t.beginPath(),t.ellipse(0,-e*10,e*18,e*20,0,0,Math.PI*2),t.fill(),t.stroke(),t.strokeStyle="#000",t.lineWidth=s(2),t.beginPath(),t.moveTo(-e*8,-e*15),t.lineTo(-e*2,-e*9),t.moveTo(-e*2,-e*15),t.lineTo(-e*8,-e*9),t.stroke(),t.beginPath(),t.moveTo(e*2,-e*15),t.lineTo(e*8,-e*9),t.moveTo(e*8,-e*15),t.lineTo(e*2,-e*9),t.stroke(),t.strokeStyle="#000",t.lineWidth=c,t.fillStyle=h.hat,t.beginPath(),t.ellipse(e*5,-e*30,e*28,e*7,.3,0,Math.PI*2),t.fill(),t.stroke(),t.beginPath(),t.moveTo(-e*8,-e*30),t.lineTo(-e*4,-e*52),t.lineTo(e*18,-e*50),t.lineTo(e*20,-e*28),t.closePath(),t.fill(),t.stroke()}),t.restore()}const R={baseWPM:25,wpmPerStreak:3,maxWPM:80,lastTypeTime:0},B={short:["draw now","hands up","stand back","hold it there","drop the gun","nice and slow","don't move","step aside","you lose","too slow","it's over","let's go"],medium:["this town ain't big enough","reach for the sky partner","you picked the wrong day","make your move cowboy","the sun sets on you","say your prayers outlaw","end of the line friend","justice comes for all","your luck's run out","time to meet your maker","you shouldn't have come here","i've been expecting you"],long:["there ain't room for both of us in this town","you should've stayed out of my territory","the wanted poster said dead or alive","i've been waiting a long time for this","they don't call me quickdraw for nothing","you rode into the wrong saloon partner","the sheriff warned you to leave by sundown","every outlaw meets their end eventually","this dusty road ends right here right now","you thought you could outrun the law forever","i reckon you've made your last mistake","there's only one way this ends partner"]};function wt(o){return o<3?B.short[Math.floor(Math.random()*B.short.length)]:o<7?B.medium[Math.floor(Math.random()*B.medium.length)]:B.long[Math.floor(Math.random()*B.long.length)]}function Pt(){const a=Math.min(R.baseWPM+i.winStreak*R.wpmPerStreak,R.maxWPM)*5,r=.8+Math.random()*.4;return 6e4/a*r}function Mt(){const o=y.width,a=y.height,r=L[i.currentBg%L.length],e=a*.7,c=t.createLinearGradient(0,0,0,e);c.addColorStop(0,r.top),c.addColorStop(.5,r.mid),c.addColorStop(1,r.bottom),t.fillStyle=c,t.fillRect(0,0,o,e);const l=o*.5,n=a*r.sunY,f=s(40);if(r.isNight){t.fillStyle="#ffffff";const m=12345;for(let P=0;P<60;P++){const u=(m+P*127)%1e3/1e3*o,D=(m+P*311)%1e3/1e3*e*.85,T=(m+P*73)%3+1;t.globalAlpha=.4+(m+P*53)%50/100,t.beginPath(),t.arc(u,D,T,0,Math.PI*2),t.fill()}t.globalAlpha=1}const d=t.createRadialGradient(l,n,f*.5,l,n,f*3);d.addColorStop(0,r.sunGlow),d.addColorStop(1,"transparent"),t.fillStyle=d,t.fillRect(0,0,o,e),t.fillStyle=r.sun,t.beginPath(),t.arc(l,n,f,0,Math.PI*2),t.fill(),t.fillStyle="#4a3728",t.beginPath(),t.moveTo(0,e),t.lineTo(o*.05,e-s(60)),t.lineTo(o*.1,e-s(80)),t.lineTo(o*.18,e-s(75)),t.lineTo(o*.22,e-s(40)),t.lineTo(o*.25,e),t.fill(),t.beginPath(),t.moveTo(o*.75,e),t.lineTo(o*.78,e-s(50)),t.lineTo(o*.85,e-s(90)),t.lineTo(o*.9,e-s(85)),t.lineTo(o*.95,e-s(55)),t.lineTo(o,e-s(30)),t.lineTo(o,e),t.fill();const g=t.createLinearGradient(0,e,0,a);g.addColorStop(0,"#c9a66b"),g.addColorStop(.3,"#b8956a"),g.addColorStop(1,"#8b7355"),t.fillStyle=g,t.fillRect(0,e,o,a-e),t.fillStyle="#d4b896",t.beginPath(),t.moveTo(o*.3,e),t.lineTo(o*.7,e),t.lineTo(o*.85,a),t.lineTo(o*.15,a),t.fill(),N(o*.08,e,.8),N(o*.92,e,1),N(o*.15,e,.5),N(o*.88,e,.6),t.fillStyle="#3d2914",t.fillRect(o*.02,e-s(50),s(60),s(50)),t.beginPath(),t.moveTo(o*.02-s(5),e-s(50)),t.lineTo(o*.02+s(30),e-s(70)),t.lineTo(o*.02+s(65),e-s(50)),t.fill(),t.fillRect(o*.98-s(50),e-s(45),s(50),s(45)),t.fillStyle="rgba(200, 180, 150, 0.3)";for(let m=0;m<8;m++){const P=o*.2+m*o*.08,u=e+s(20+m%3*15);t.beginPath(),t.ellipse(P,u,s(15+m*2),s(5),0,0,Math.PI*2),t.fill()}}function N(o,a,r){const e=s(1)*r,c="#2d5a27";t.fillStyle=c,t.strokeStyle="#1a3a17",t.lineWidth=s(1),t.beginPath(),t.roundRect(o-e*8,a-e*60,e*16,e*60,e*5),t.fill(),t.stroke(),t.beginPath(),t.roundRect(o-e*30,a-e*45,e*25,e*10,e*4),t.fill(),t.stroke(),t.beginPath(),t.roundRect(o-e*30,a-e*55,e*10,e*20,e*4),t.fill(),t.stroke(),t.beginPath(),t.roundRect(o+e*5,a-e*35,e*22,e*10,e*4),t.fill(),t.stroke(),t.beginPath(),t.roundRect(o+e*18,a-e*50,e*10,e*25,e*4),t.fill(),t.stroke()}function s(o){return o*(y.height/400)}function et(o,a,r,e,c){t.save();const l=r?1:-1,n=s(1),f=s(3);t.lineWidth=f,t.lineCap="round",t.lineJoin="round",t.strokeStyle="#000";function d(st,ct){t.fillStyle=st,t.beginPath(),ct(),t.fill(),t.stroke()}const g=a,m=n*45,P=n*50,u=g-m-P,T=g-m,w=u+n*15;d(h.pants,()=>{t.moveTo(o-l*n*8,T),t.lineTo(o-l*n*12,g-n*15),t.lineTo(o-l*n*8,g-n*15),t.lineTo(o-l*n*5,T),t.closePath()}),d(h.boots,()=>{t.moveTo(o-l*n*12,g-n*15),t.lineTo(o-l*n*15,g),t.lineTo(o-l*n*5,g),t.lineTo(o-l*n*8,g-n*15),t.closePath()}),d(h.pants,()=>{t.moveTo(o+l*n*5,T),t.lineTo(o+l*n*2,g-n*15),t.lineTo(o+l*n*10,g-n*15),t.lineTo(o+l*n*8,T),t.closePath()}),d(h.boots,()=>{t.moveTo(o+l*n*2,g-n*15),t.lineTo(o+l*n*0,g),t.lineTo(o+l*n*12,g),t.lineTo(o+l*n*10,g-n*15),t.closePath()}),d(h.shirt,()=>{t.moveTo(o-l*n*15,w),t.lineTo(o+l*n*18,w),t.lineTo(o+l*n*12,T),t.lineTo(o-l*n*10,T),t.closePath()}),d(h.vest,()=>{t.moveTo(o+l*n*5,w),t.lineTo(o+l*n*16,w+n*5),t.lineTo(o+l*n*10,T),t.lineTo(o+l*n*5,T),t.closePath()});const E=o-l*n*12;d(h.shirt,()=>{t.moveTo(E,w+n*5),t.lineTo(E-l*n*5,w+n*25),t.lineTo(E-l*n*2,w+n*28),t.lineTo(E+l*n*3,w+n*8),t.closePath()}),d(h.skin,()=>{t.arc(E-l*n*3,w+n*30,n*6,0,Math.PI*2)}),d(h.skin,()=>{t.fillRect(o+l*n*2-n*5,u+n*5,n*10,n*12),t.strokeRect(o+l*n*2-n*5,u+n*5,n*10,n*12)}),d(h.skin,()=>{t.ellipse(o+l*n*2,u-n*10,n*18,n*20,0,0,Math.PI*2)}),t.fillStyle="#000",t.beginPath(),t.ellipse(o+l*n*10,u-n*12,n*3,n*4,0,0,Math.PI*2),t.fill(),t.beginPath(),t.moveTo(o+l*n*5,u-n*20),t.lineTo(o+l*n*14,u-n*17),t.stroke(),t.beginPath(),t.moveTo(o+l*n*15,u-n*10),t.lineTo(o+l*n*18,u-n*5),t.lineTo(o+l*n*14,u-n*3),t.stroke(),t.beginPath(),t.moveTo(o+l*n*8,u+n*2),t.quadraticCurveTo(o+l*n*14,u+n*5,o+l*n*16,u+n*2),t.stroke(),d(h.hat,()=>{t.ellipse(o+l*n*2,u-n*25,n*30,n*8,0,0,Math.PI*2)}),d(h.hat,()=>{t.moveTo(o-l*n*12,u-n*25),t.lineTo(o-l*n*8,u-n*50),t.lineTo(o+l*n*15,u-n*50),t.lineTo(o+l*n*18,u-n*25),t.closePath()}),t.fillStyle=h.hatBand,t.fillRect(o-l*n*10,u-n*30,n*26,n*5),t.strokeRect(o-l*n*10,u-n*30,n*26,n*5);const I=o+l*n*15,z=w+n*8,U=90,b=(U+((r?0:180)-U)*e)*Math.PI/180,$=n*25,H=n*25,W=I+Math.cos(b)*$,Y=z+Math.sin(b)*$,S=b+(r?.3:-.3),k=W+Math.cos(S)*H,F=Y+Math.sin(S)*H;t.fillStyle=h.shirt,t.beginPath(),t.moveTo(I-Math.sin(b)*n*6,z+Math.cos(b)*n*6),t.lineTo(I+Math.sin(b)*n*6,z-Math.cos(b)*n*6),t.lineTo(W+Math.sin(b)*n*5,Y-Math.cos(b)*n*5),t.lineTo(W-Math.sin(b)*n*5,Y+Math.cos(b)*n*5),t.closePath(),t.fill(),t.stroke(),t.fillStyle=h.shirt,t.beginPath(),t.moveTo(W-Math.sin(S)*n*5,Y+Math.cos(S)*n*5),t.lineTo(W+Math.sin(S)*n*5,Y-Math.cos(S)*n*5),t.lineTo(k+Math.sin(S)*n*4,F-Math.cos(S)*n*4),t.lineTo(k-Math.sin(S)*n*4,F+Math.cos(S)*n*4),t.closePath(),t.fill(),t.stroke(),d(h.skin,()=>{t.arc(k,F,n*7,0,Math.PI*2)});const M=S,q=n*25,V=k+Math.cos(M)*q,J=F+Math.sin(M)*q;t.fillStyle=h.gun,t.beginPath(),t.moveTo(k-Math.sin(M)*n*4,F+Math.cos(M)*n*4),t.lineTo(k+Math.sin(M)*n*4,F-Math.cos(M)*n*4),t.lineTo(V+Math.sin(M)*n*2,J-Math.cos(M)*n*2),t.lineTo(V-Math.sin(M)*n*2,J+Math.cos(M)*n*2),t.closePath(),t.fill(),t.stroke();const A=M+(r?Math.PI/2:-Math.PI/2),j=k+Math.cos(A)*n*10,K=F+Math.sin(A)*n*10;t.fillStyle=h.vest,t.beginPath(),t.moveTo(k-Math.sin(A)*n*4,F+Math.cos(A)*n*4),t.lineTo(k+Math.sin(A)*n*4,F-Math.cos(A)*n*4),t.lineTo(j+Math.sin(A)*n*3,K-Math.cos(A)*n*3),t.lineTo(j-Math.sin(A)*n*3,K+Math.cos(A)*n*3),t.closePath(),t.fill(),t.stroke(),t.fillStyle=h.gunHighlight,t.beginPath(),t.arc(k+Math.cos(M)*n*5,F+Math.sin(M)*n*5,n*5,0,Math.PI*2),t.fill(),t.stroke(),t.restore()}function G(o,a,r,e,c){const l=s(e);t.font=`bold ${l}px "Courier New", monospace`,t.textAlign="center",t.textBaseline="middle";const n=s(3);t.fillStyle="#000",t.fillText(o,a+n,r+n),t.strokeStyle="#000",t.lineWidth=s(4),t.strokeText(o,a,r),t.fillStyle=c,t.fillText(o,a,r)}function ot(o,a,r,e,c){const l=s(c);t.font=`bold ${l}px "Courier New", monospace`;const n=t.measureText("W").width,f=o.length*n;let d=r-f/2,g=0,m=0;const P=Date.now()<i.errorShakeUntil;P&&(g=(Math.random()-.5)*s(16),m=(Math.random()-.5)*s(16));const u=s(3);for(let D=0;D<o.length;D++){let T=x.textPrimary,w=o[D];D<a.length?T=x.textCorrect:D===a.length&&i.wrongChar&&P&&(T=x.textError);const E=d+D*n+n/2+g,I=e+m;t.fillStyle="#000",t.textAlign="center",t.fillText(w,E+u,I+u),t.strokeStyle="#000",t.lineWidth=s(3),t.strokeText(w,E,I),t.fillStyle=T,t.fillText(w,E,I)}}function bt(o,a){Date.now()<i.muzzleFlashUntil&&(t.fillStyle="#FFFF00",t.beginPath(),t.arc(o,a,s(18),0,Math.PI*2),t.fill(),t.fillStyle="#FFFFFF",t.beginPath(),t.arc(o,a,s(8),0,Math.PI*2),t.fill())}function St(){t.font=`bold ${s(28)}px "Courier New", monospace`,t.textAlign="right",t.textBaseline="top",t.fillStyle="#000",t.fillText(`${i.winStreak}`,y.width-s(17),s(23)),t.fillStyle=x.textStreak,t.fillText(`${i.winStreak}`,y.width-s(20),s(20)),t.fillStyle=x.textStreak,t.font=`${s(24)}px serif`,t.fillText("â˜…",y.width-s(50),s(20))}function lt(){t.clearRect(0,0,y.width,y.height),Mt();const o=y.width*.25,a=y.width*.75,r=y.height*.8;if(p.active&&p.isPlayer?tt(o,r):et(o,r,!0,i.playerArmDisplay),p.active&&!p.isPlayer?tt(a,r):et(a,r,!1,i.aiArmDisplay),i.phase==="finished"&&i.winner){const l=i.winner==="player"?o+s(70):a-s(70);bt(l,r-s(80))}mt(),vt(),St();const e=y.width/2,c=y.height*.9;if(i.phase==="idle")G("Press Space to Start",e,s(100),44,x.textPrimary),t.font=`${s(18)}px "Courier New", monospace`,t.textAlign="center",t.fillStyle="#000",t.fillText("Type the sentence when you see DRAW!",e+s(2),c+s(2)),t.fillStyle="#FFF",t.fillText("Type the sentence when you see DRAW!",e,c);else if(i.phase==="countdown"){const l=L[i.currentBg%L.length],n=y.height*l.sunY;G(i.countdownValue.toString(),e,n,80,"#FFF")}else i.phase==="playing"?i.currentWord&&ot(i.currentWord,i.playerTyped,e,s(120),56):i.phase==="finished"&&(i.winner==="player"?G("YOU WIN!",e,s(80),64,x.textCorrect):G("YOU LOSE!",e,s(80),64,x.textError),i.currentWord&&ot(i.currentWord,i.playerTyped,e,s(150),48),i.showingResult||(t.font=`${s(18)}px "Courier New", monospace`,t.textAlign="center",t.fillStyle="#000",t.fillText("Press Space or Enter to continue",e+s(2),c+s(2)),t.fillStyle="#FFF",t.fillText("Press Space or Enter to continue",e,c)))}function kt(){i.countdownInterval&&(clearInterval(i.countdownInterval),i.countdownInterval=null),i.timeouts.forEach(o=>clearTimeout(o)),i.timeouts=[]}function nt(o,a){const r=setTimeout(()=>{i.timeouts=i.timeouts.filter(e=>e!==r),o()},a);return i.timeouts.push(r),r}function O(){kt(),i.phase="countdown",i.countdownValue=3,i.currentWord="",i.playerTyped="",i.playerProgress=0,i.playerArmDisplay=0,i.playerErrors=0,i.aiProgress=0,i.aiArmDisplay=0,i.aiTyped="",i.winner=null,i.playerFinishTime=null,i.aiFinishTime=null,i.showDraw=!1,i.showingResult=!1,i.errorShakeUntil=0,i.muzzleFlashUntil=0,i.wrongChar=null,i.bullet=null,i.blood=[],v.player.position=0,v.player.velocity=0,v.player.target=0,v.ai.position=0,v.ai.velocity=0,v.ai.target=0,ft(),i.currentBg=(i.currentBg+1)%L.length,C.value="",C.focus(),i.countdownInterval=setInterval(()=>{if(i.phase!=="countdown"){clearInterval(i.countdownInterval),i.countdownInterval=null;return}i.countdownValue--,i.countdownValue<1&&(clearInterval(i.countdownInterval),i.countdownInterval=null,Ft())},1e3)}function Ft(){i.phase==="countdown"&&(i.phase="playing",i.currentWord=wt(i.winStreak),i.roundStartTime=Date.now(),R.lastTypeTime=Date.now())}function At(o){if(i.phase!=="playing"||i.playerFinishTime!==null)return;const a=C.value.toLowerCase(),r=i.playerTyped;if(a.length<=r.length){C.value=r;return}const e=i.currentWord[r.length];for(let l=r.length;l<a.length;l++)if(a[l]===e){i.playerTyped=r+e,i.wrongChar=null;break}else i.wrongChar=a[l],i.errorShakeUntil=Date.now()+300,i.playerErrors++;C.value=i.playerTyped;const c=i.playerTyped.length/i.currentWord.length;i.playerProgress=c,Q(c),i.playerTyped.length===i.currentWord.length&&(i.playerFinishTime=Date.now(),i.playerProgress=1,Q(1),rt())}function Dt(){if(i.phase!=="playing"||i.aiProgress>=1)return;const o=Date.now(),a=Pt();o-R.lastTypeTime>=a&&(R.lastTypeTime=o,i.aiTyped+=i.currentWord[i.aiTyped.length],i.aiProgress=i.aiTyped.length/i.currentWord.length,_(i.aiProgress),i.aiTyped===i.currentWord&&(i.aiFinishTime=Date.now(),i.aiProgress=1,_(1),rt()))}function rt(){if(i.winner)return;const o=i.playerFinishTime!==null,a=i.aiFinishTime!==null;if(!o&&!a)return;if(o&&!a){X("player");return}if(a&&!o){X("ai");return}Math.abs(i.playerFinishTime-i.aiFinishTime)>200?X(i.playerFinishTime<i.aiFinishTime?"player":"ai"):X(i.playerErrors===0?"player":"ai")}function X(o){if(i.phase!=="playing")return;i.phase="finished",i.winner=o,i.showingResult=!0,i.muzzleFlashUntil=Date.now()+150,i.roundEndTime=Date.now();const a=y.width*.25,r=y.width*.75,c=y.height*.8-s(60);o==="player"?(i.winStreak++,Z(a+s(50),c,r,c,!0)):(i.winStreak=0,Z(r-s(50),c,a,c,!1)),nt(()=>{i.phase==="finished"&&(i.showingResult=!1)},1500),nt(()=>{i.phase==="finished"&&(i.phase="idle")},2500)}function at(){Dt(),dt(),yt(),gt(),ut(),lt(),requestAnimationFrame(at)}y.addEventListener("click",()=>{i.phase==="idle"&&O()});document.addEventListener("click",()=>{i.phase==="idle"&&O(),C.focus()});C.addEventListener("input",At);C.addEventListener("keydown",o=>{o.key==="Enter"&&o.preventDefault()});document.addEventListener("keydown",o=>{i.phase==="playing"&&C.focus(),(i.phase==="idle"||i.phase==="finished"&&Date.now()-i.roundEndTime>=1e3)&&(o.key===" "||o.key==="Enter")&&(o.preventDefault(),O())});console.log("Quick Draw loaded!");lt();at();
